<!doctype html>
<html>
  <script type='text/javascript'>
    var canvas = null;
    var img = null;
    var ctx = null;
    var imageReady = false;
    /* ANIMATION VARIABLES */ 
    var frame = 0;
    var tLastUpdate = 0; 
    var dt = 0; 
    const MS_PER_FRAME = 100; 
    const FRAMES_PER_S = 1000/60;  
    /* SPRITE VARIABLES */ 
    var ariel = {
      speed: 20, 
      x: 0, 
      y: 0, 
      moving: false,
    }
    var swimmerSprite = {
        height: 42, 
        width: 62, 
        halfWidth: 62/2, 
        nFrames: 8, 
        img: null, 
        leftim: null, 
        rightim: null, 
        imageReady: true, 
    }
    var stillSprite = {
        height: 58, 
        width: 36, 
        halfWidth: 18, 
        nFrames: 6, 
        img: null, 
        imageReady: true, 
    }
    var currentSprite = stillSprite; 
    /* SETTING UP PLAYER INPUT */ 
    const upKey = 38; 
    const downKey = 40; 
    const leftKey = 37; 
    const rightKey = 39; 
    var keysDown = {}; 
    addEventListener("keydown", function(e) {
      keysDown[e.keyCode] = true; 
    }, false); 
    addEventListener("keyup", function(e) {
      delete keysDown[e.keyCode];  
      ariel.moving = false; 
    }, false); 
    /* SCRIPT FUNCTIONS */ 
    function onload() {
      canvas = document.getElementById('spriteCanvas');
      ctx = canvas.getContext("2d");
      ariel.x = canvas.width/2; 
      ariel.y = canvas.height/2; 
      swimmerSprite.leftim = new Image();
      swimmerSprite.leftim.src = 'ariel.png';
      swimmerSprite.rightim = new Image(); 
      swimmerSprite.rightim.src = 'arielSwimRight.png'; 
      stillSprite.img = new Image(); 
      stillSprite.img.src = 'arielStill.png'; 
      ocean = ctx.createLinearGradient(0,0,0,500); 
      ocean.addColorStop(0, "#13F6E5"); 
      ocean.addColorStop(1, "#16124D"); 
      stillSprite.img.onload = loaded();
      resize();
    }
    function loaded() {
      imageReady = true; 
        swimmerSprite.imageReady = true;
        setTimeout(animate, FRAMES_PER_S);
    }
    function resize() {
      var w0 = canvas.width; 
      var h0 = canvas.height; 
      canvas.width = canvas.parentNode.clientWidth;
      canvas.height = canvas.parentNode.clientHeight;
      ariel.x = (canvas.width/w0) * ariel.x; 
      ariel.y = (canvas.height/h0) * ariel.y; 
      redraw();
    }
    function redraw() {
        ctx.fillStyle = ocean;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        if (ariel.moving) drawSprite(swimmerSprite, ariel.x, ariel.y); 
        else drawSprite(stillSprite, ariel.x, ariel.y);
        // if (swim) drawSprite(swimmerSprite, ariel.x, ariel.y); 
        // else drawSprite(stillSprite, ariel.x, ariel.y); 
    }

    function drawSprite(sprite, x, y) {
      if (sprite.imageReady) {
          ctx.drawImage(sprite.img, frame*sprite.width, 0, sprite.width, sprite.height,
                          x - sprite.halfWidth, y - sprite.halfWidth, sprite.width, sprite.height);
      }
    }
    var update = function(modifier) {
      if (upKey in keysDown) {
        ariel.y -= ariel.speed * modifier;
      }
      if (downKey in keysDown) {
        ariel.y += ariel.speed * modifier; 
      }
      if (leftKey in keysDown) {
        ariel.x -= ariel.speed * modifier;
        ariel.moving = true; 
        swimmerSprite.img = swimmerSprite.leftim; 
      }
      if (rightKey in keysDown) {
        ariel.x += ariel.speed * modifier;
        ariel.moving = true; 
        swimmerSprite.img = swimmerSprite.rightim; 
      }
    }
    function animate() {
        requestAnimationFrame(animate); 
        update(dt/1000); 
        if (dt > MS_PER_FRAME) {
          redraw(); 
          frame++; 
          if (frame >= currentSprite.nFrames) frame = 0;
          dt = 0; 
        } else 
        {
          dt += Date.now() - tLastUpdate; 
        }
        tLastUpdate = Date.now(); 
    }

  </script>
  </head>

<body onresize='onresize()' onload='onload()' style='position: absolute; padding:0; margin:0; height: 100%; width:100%'>

<canvas id="spriteCanvas"></canvas>

</body>
</html>